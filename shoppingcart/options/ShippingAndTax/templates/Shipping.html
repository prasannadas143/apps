{% extends "base.html" %}
{% load static from staticfiles %}
{% load admin_urls %}
{% load bootstrap3 %}
{% load get_item %}

{% block title %}
{% endblock %}
{% block extraHeader %}
{% endblock %}
{% block content %}

<script type="text/javascript">
function getCookie(name) {
    var cookieValue = null;
    if (document.cookie && document.cookie != '') {
        var cookies = document.cookie.split(';');
        for (var i = 0; i < cookies.length; i++) {
            var cookie = jQuery.trim(cookies[i]);
            // Does this cookie string begin with the name we want?
            if (cookie.substring(0, name.length + 1) == (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}    
 
function Remove(button) {
    //Determine the reference of the Row using the Button.
    var row = button.parentNode.parentNode;
    var node = row.getElementsByTagName("TD")[0].childNodes
    var name = node[0].value;
    if (confirm("Do you want to delete: " + name)) {
    
        if (row.children.length == 6) {
            triggerurl = '/shoppingcart/options/ShippingAndTax/deleteshipping/' 
            $.ajax({
              url: triggerurl,
              method: 'POST',
              data : {
                    "id" : row.children[5].value,
                    "csrfmiddlewaretoken" : getCookie('csrftoken'),

                     },
              }).success(function (data, jqXHR) 
              {
                    $('.modal-title').text('Shopping info deleted successfully');
                    $("#messageStatus").modal();
              }).error(function (jqXHR, errorThrown) {
                $('.modal-title').text('Shopping info not deleted');
                $("#messageStatus").modal();
            }); 
            //Get the reference of the Table.
            var table = document.getElementById("tblshopping");

            //Delete the Table row using it's Index.
            table.deleteRow(row.rowIndex);  
            return true;
        }
       
         
    }
};

function AddRow() {
    //Get the reference of the Table's TBODY element.
    var tBody = document.getElementById("tblshopping").getElementsByTagName("TFOOT")[0];

	var rowCount = tBody.rows.length;
	i = rowCount + 1
    //Add Row.
    row = tBody.insertRow(-1);

    //Add Location cell.
    var cell = row.insertCell(-1);
    var location = document.createElement("INPUT");
    location.type = 'text';
	location.name = 'location_' + i;
	location.id = 'location_' + i;
	location.size = 60;
    // cell.contentEditable = "true";
    cell.appendChild(location);


	//Add shipping .
    cell = row.insertCell(-1);
    var shipping = document.createElement("INPUT");
    shipping.type = 'text';
	shipping.name = 'shipping_' + i;
	shipping.id = 'shipping_' + i;
	shipping.size = 60;
	// cell.contentEditable = "true";
    cell.appendChild(shipping);

 
	//Add Country cell.
    cell = row.insertCell(-1);
    var free_shipping = document.createElement("INPUT");
    free_shipping.type = 'text';
	free_shipping.name = 'free_shipping_' + i;
	free_shipping.id = 'free_shipping_' + i;
	free_shipping.size = 60;
    cell.appendChild(free_shipping);

	// cell.contentEditable = "true";

	//Add Country cell.
    cell = row.insertCell(-1);
    var shipping_tax = document.createElement("INPUT");
    shipping_tax.type = 'text';
	shipping_tax.name = 'tax_' + i;
	shipping_tax.id = 'tax_' + i;
	shipping_tax.size = 60;
	// cell.contentEditable = "true";
    cell.appendChild(shipping_tax);

	
	//Add Button cell.
    cell = row.insertCell(-1);
    var btnRemove = document.createElement("INPUT");
    btnRemove.type = "button";
    btnRemove.value = "Remove";
    btnRemove.setAttribute("onclick", "Remove(this);");
    cell.appendChild(btnRemove);
}

    </script>
<div class="modal fade" id="messageStatus" role="dialog">
    <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header" style="text-align: center;">
                <h4 class="modal-title"></h4>
            </div>
            <div class="modal-body" style="text-align: center;">
                <button type="button" data-dismiss="modal" class="btn btn-primary" id="Ok">Ok</button>
                <button type="button" data-dismiss="modal" class="btn">Cancel</button>
            </div>
        </div>
    </div>
</div>
{% for field in form %}
    <div class="fieldWrapper">
        {% if field.errors %}
        <span><p>   {{ field.html_name }}   {{ field.errors }}</p></span>
        {% endif %}
       
    </div>
{% endfor %}
{% if messages %}
<ul class="messages">
    {% for message in messages %}
    <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</li>
    {% endfor %}
</ul>
{% endif %}
 <form class="form-horizontal" role="form" method="POST"  action="/shoppingcart/options/ShippingAndTax/shipping/">  {% csrf_token %}  
 	<table id="tblshopping" cellpadding="0" cellspacing="0" border="1">
        <thead>
            <tr>
                <th>Location</th>
                <th>Shipping</th>
                <th>Free Shipping</th>
				<th>Shipping Tax</th>

            </tr>
        </thead>
			<tbody>
			</tbody>
			<tfoot>
            {% for shipping in shippings %}

            <tr> 
                <td><input type="text" name="location_{{ forloop.counter }}" value="{{ shipping.location }}" size="60" > </td>
                <td> <input type="text" name="shipping_{{ forloop.counter }}" value="{{ shipping.shipping }}" size="60" > </td> 
                <td> <input type="text" name="free_shipping_{{ forloop.counter }}" value="{{ shipping.free_shipping }}" size="60" > </td> 
                <td> <input type="text" name="tax_{{ forloop.counter }}" value="{{ shipping.tax }}" size="60" > </td> 
                <td><input type="button" value="Remove" onclick="Remove(this);"></td>
                <input type="hidden" name="shippingid_{{ forloop.counter }}" value="{{ shipping.id }}">

            </tr>

            {% endfor %}

			</tfoot>
	</table>
	<input type="button" onclick="AddRow()" value="Add" />
	<input type="submit"  value="Save" />
</form>



{% endblock %}