{% extends "base.html" %}
{% load static from staticfiles %}
{% load admin_urls %}
{% load bootstrap3 %}
{% block title %}Dashboard{% endblock %}
{% block extraHeader %}
{% endblock %}
{% block content %}            



			<div id="sendmailmodal" class="modal">

		<!-- Modal content -->
				<div class="modal-content">
					<div class="modal-header">
						<span class="close">&times;</span>
						<h2>Send Email</h2>
					</div>
					<div class="modal-body">
					  Subject:<br>
					  <input type="text" name="subject" id="subjectmail" value="{{ subject_email }}" ><br>
					  Message:<br>
						<textarea rows="4" cols="50" id="mailcontent" >{{ emailbody }}</textarea>
						<input type="button" id="clicksendmail" value="sendmail">
					</div>
				</div>
				<div class="modal-footer">
					<h3>Modal Footer</h3>
				</div>
			</div>

			<div id="sendmsgmodal" class="modal">
		<!-- Modal content -->
				<div class="modal-content">
					<div class="modal-header">
						<span class="close">&times;</span>
						<h2>Send Message</h2>
					</div>
					<div class="modal-body">
					 Message:<br>
						<textarea rows="4" cols="50" id="msgcontent">{{ smsbody }}</textarea>
						<input type="button" id="clicksendmsg" value="sendmsg">
					</div>
				</div>
				<div class="modal-footer">
					<h3>Modal Footer</h3>
				</div>
			</div>
<div>

		<a href="{% url 'appointmentschduler:getinvoicepdf' invoicedetails.id  %}" class="button">Print</a>
  			<input type="hidden" name="bookingpk" id="bookingpk" value={{ bookingpk }}>

			<p>
				<label class="title">Invoiceid:</label>
				<input type="text" name="invoiceid" id="invoiceid" class="pj-form-field required valid" aria-required="true" aria-invalid="false" value="{{ invoicedetails.invoice_id }}" >
			</p>
		
			<p>
				<label class="title">Invoiceno:</label>
				<input type="text" name="invoiceno" id="invoiceno" class="pj-form-field required valid" aria-required="true" aria-invalid="false" value="{{ invoicedetails.invoiceno }}" >
			</p>
		
			<p>
				<label class="title">Status:</label>
				<input type="text" name="booking_status" id="booking_status" class="pj-form-field required valid" aria-required="true" aria-invalid="false" value="{{ invoicedetails.booking_status }}" >
			</p>
			
			<p>
				<label class="title">created date :</label>
				<input type="text" name="created" id="created" class="pj-form-field required valid" aria-required="true" aria-invalid="false" value="{{ invoicedetails.created }}" >
					
			</p>
			<p>
				<label class="title">issued date :</label>
				<input type="text" name="issued" id="issued" class="pj-form-field required valid" aria-required="true" aria-invalid="false" value="{{ invoicedetails.issued }}" >
					
			</p>
			<p>
				<label class="title">Due date :</label>
				<input type="text" name="duedate" id="duedate" class="pj-form-field required valid" aria-required="true" aria-invalid="false" value="{{ invoicedetails.duedate }}" >
					
			</p>

			<p>
				<label class="title">client:</label>
				<input type="text" name="client" id="client" class="pj-form-field required valid" aria-required="true" aria-invalid="false" value="{{ invoicedetails.c_name }}" >
			</p>

			<p>
				<label class="title">Email:</label>
				<input type="text" name="c_email" id="c_email" class="pj-form-field required valid" aria-required="true" aria-invalid="false" value="{{ invoicedetails.c_email }}" >
			</p>

			<p>
				<label class="title">IP Address:</label>
				<input type="text" name="ipaddress" id="ipaddress" class="pj-form-field required valid" aria-required="true" aria-invalid="false" value="{{ invoicedetails.ip }}" >
			</p>

		</div>

		<div id="serviceerror"></div>
		<p>
			<label class="title">&nbsp;</label>
			<div id="addservices"> <table id="addservicedata" class="table table-striped table-bordered table-hover"    cellspacing="0" width="100%" >	<tr><th>Service</th><th>Price</th><th> Total </th><th></th><th></th></tr>
					<tr ><td> {{ invoicedetails.service }}  </td><td>{{ invoicedetails.price }}</td><td> {{ invoicedetails.total }} </td>  
					<td>               
					 <button type="button" data-dismiss="modal" class="btn btn-primary" id="sendmail">SendMail</button> </td>
					<td> <button type="button" data-dismiss="modal" class="btn btn-primary" id="sendsms">SendSMS</button> </td>
					</tr>
				</table>
			</div>
			
		</p>
		<div class="float_left w350 t15">
			
			<p>
				<label class="title">Subtotal:</label>
				<span class="pj-form-field-custom pj-form-field-custom-before">
					<span class="pj-form-field-before"><abbr class="pj-form-field-icon-text">€</abbr></span>
					<input type="text" name="Subtotal" id="Subtotal" class="pj-form-field number w90 required" value="{{ invoicedetails.price }}" aria-required="true">
				</span>
			</p>

			<p>
				<label class="title">Discount:</label>
				<span class="pj-form-field-custom pj-form-field-custom-before">
					<span class="pj-form-field-before"><abbr class="pj-form-field-icon-text">€</abbr></span>
					<input type="text" name="tax" id="tax" class="pj-form-field number w90"   value="{{ invoicedetails.discount }}">
				</span>
			</p>
			
			<p>
				<label class="title">Tax:</label>
				<span class="pj-form-field-custom pj-form-field-custom-before">
					<span class="pj-form-field-before"><abbr class="pj-form-field-icon-text">€</abbr></span>
					<input type="text" name="tax" id="tax" class="pj-form-field number w90"   value="{{ invoicedetails.tax }}">
				</span>
			</p>
			<p>
				<label class="title">Total:</label>
				<span class="pj-form-field-custom pj-form-field-custom-before">
					<span class="pj-form-field-before"><abbr class="pj-form-field-icon-text">€</abbr></span>
					<input type="text" name="total" id="total" class="pj-form-field number w90"  value="{{ invoicedetails.total }}" >
				</span>
			</p>

			<p>
				<label class="title">Deposit:</label>
				<span class="pj-form-field-custom pj-form-field-custom-before">
					<span class="pj-form-field-before"><abbr class="pj-form-field-icon-text">€</abbr></span>
					<input type="text" name="deposit" id="deposit" class="pj-form-field number w90"  value="{{ invoicedetails.deposit }}" >
				</span>
			</p>
			<p>
				<label class="title">Amount Due:</label>
				<span class="pj-form-field-custom pj-form-field-custom-before">
					<span class="pj-form-field-before"><abbr class="pj-form-field-icon-text">€</abbr></span>
					<input type="text" name="amount_due" id="amount_due" class="pj-form-field number w90"  value="{{ .invoicedetails.amount_due }}" >
				</span>
			</p>

		</div>
		<div class="float_right w350 t15">
			<p>
				<label class="title">Notes:</label>
				<textarea name="c_notes" id="c_notes" class="pj-form-field w334 h120"  value="{{ invoicedetails.c_notes }}"></textarea>
			</p>
		</div>

</div>
<script>
// Get the modal
var smmodal = document.getElementById('sendmailmodal');
var msmodal = document.getElementById('sendmsgmodal');

// Get the button that opens the modal


var sendmail = document.getElementById("sendmail");
var sendmsg = document.getElementById("sendsms");

// Get the <span> element that closes the modal
var span_mail = document.getElementsByClassName("close")[0];
var span_msg = document.getElementsByClassName("close")[1];
var sendmailbutton = document.getElementById('clicksendmail');
var sendmsgbutton = document.getElementById('clicksendmsg');
// var servicedetails = document.getElementById("servicedetails");

// When the user clicks the button, open the modal

function getCookie(name) {
    var cookieValue = null;
    if (document.cookie && document.cookie != '') {
        var cookies = document.cookie.split(';');
        for (var i = 0; i < cookies.length; i++) {
            var cookie = jQuery.trim(cookies[i]);
            // Does this cookie string begin with the name we want?
            if (cookie.substring(0, name.length + 1) == (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

function csrfSafeMethod(method) {
    // these HTTP methods do not require CSRF protection
    return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
}

$.ajaxSetup({
    beforeSend: function(xhr, settings) {
        if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
            // Only send the token to relative URLs i.e. locally.
            xhr.setRequestHeader("X-CSRFToken", getCookie('csrftoken'));
        }
    },

    error: function(xhr, textStatus, error) {
        console.log(error);
    }
});
sendmail.onclick = function() {
    smmodal.style.display = "block";
}

sendmsg.onclick = function() {
    msmodal.style.display = "block";
}

$('#clicksendmail').onclick = function() {
    smmodal.style.display = "none";
}

$('#clicksendmsg').onclick = function() {
    msmodal.style.display = "none";
}


// When the user clicks on <span> (x), close the modal
span_mail.onclick = function() {
    smmodal.style.display = "none";
}

span_msg.onclick = function() {
    msmodal.style.display = "none";
}

sendmailbutton.onclick = function () {
	id = $('#bookingpk').val();
	mailcontent = document.getElementById("mailcontent").innerHTML ;
	subjectmail = $('#subjectmail').val();
    $.ajax({
          url: "/appointmentschduler/sendmail_invoice/",
          method: 'POST',
          data: {
	          "bookingpk": id,
	          "subjectmail": subjectmail,
	          "mailcontent": mailcontent,
	      }

      }).success(function (data, textStatus, jqXHR) {
          

      }).error(function (jqXHR, textStatus, errorThrown) {
          console.log(jqXHR)
      });         
};

sendmsgbutton.onclick = function () {
	id = $('#bookingpk').val();
	msgcontent = $('#msgcontent').val();
    $.ajax({
          url: "/appointmentschduler/sendmsg_invoice/",
          method: 'POST',
          data: {
	          "bookingpk": id,
	          "msgcontent": msgcontent,
	      }

      }).success(function (data, textStatus, jqXHR) {
          

      }).error(function (jqXHR, textStatus, errorThrown) {
          console.log(jqXHR)
      });         
};

// When the user clicks anywhere outside of the modal, close it
window.onclick = function(event) {
    if (event.target == smmodal) {
        smmodal.style.display = "none";
    }
    if (event.target == msmodal) {
        msmodal.style.display = "none";
    }

}


</script>

	
{% endblock %}