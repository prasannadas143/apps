{% extends "base.html" %}
{% load static from staticfiles %}
{% load admin_urls %}
{% load bootstrap3 %}
{% block title %}Dashboard{% endblock %}
{% block extraHeader %}
{% endblock %}
{% block content %} 
<style>
/* The Modal (background) */
.modal {
    display: none; /* Hidden by default */
    position: fixed; /* Stay in place */
    z-index: 1; /* Sit on top */
    left: 0;
    top: 0;
    width: 100%; /* Full width */
    height: 100%; /* Full height */
    overflow: auto; /* Enable scroll if needed */
    background-color: rgb(0,0,0); /* Fallback color */
    background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
    -webkit-animation-name: fadeIn; /* Fade in the background */
    -webkit-animation-duration: 0.4s;
    animation-name: fadeIn;
    animation-duration: 0.4s
}

/* Modal Content */
.modal-content {
    position: fixed;
    bottom: 0;
    background-color: #fefefe;
    width: 100%;
    -webkit-animation-name: slideIn;
    -webkit-animation-duration: 0.4s;
    animation-name: slideIn;
    animation-duration: 0.4s
}

/* The Close Button */
.close {
    color: white;
    float: right;
    font-size: 28px;
    font-weight: bold;
}

.close:hover,
.close:focus {
    color: #000;
    text-decoration: none;
    cursor: pointer;
}

.modal-header {
    padding: 2px 16px;
    background-color: #5cb85c;
    color: white;
}

.modal-body {padding: 2px 16px;}

.modal-footer {
    padding: 2px 16px;
    background-color: #5cb85c;
    color: white;
}

/* Add Animation */
@-webkit-keyframes slideIn {
    from {bottom: -300px; opacity: 0}
    to {bottom: 0; opacity: 1}
}

@keyframes slideIn {
    from {bottom: -300px; opacity: 0}
    to {bottom: 0; opacity: 1}
}

@-webkit-keyframes fadeIn {
    from {opacity: 0}
    to {opacity: 1}
}

@keyframes fadeIn {
    from {opacity: 0}
    to {opacity: 1}
}
</style>

<div>
<div class="notice-box">
<span class="notice-info">&nbsp;</span>
<span class="block bold">Add a booking</span>
    <span class="block">Fill in the form below to add a new booking. Under Clients tab you can enter information about the client. </span>
    <a href="#" class="notice-close"></a>		</div>
     <form class="form pj-form"   name="addbooking" autocomplete="off" enctype="multipart/form-data" novalidate="novalidate"
           action="{% url 'appointmentschduler:addbooking' %}" method="post"   onsubmit="return validatebookingform()" > {% csrf_token %}
            <fieldset class="fieldset white">
					<legend>Booking details</legend>
					<div class="float_left w450">
						<p>
							<label class="title">Unique ID:</label>
							<input type="text" name="uuid" id="uuid" class="pj-form-field w100 required" value="{{ bookingid }}" aria-required="true" style="background-image: url(&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAfBJREFUWAntVk1OwkAUZkoDKza4Utm61iP0AqyIDXahN2BjwiHYGU+gizap4QDuegWN7lyCbMSlCQjU7yO0TOlAi6GwgJc0fT/fzPfmzet0crmD7HsFBAvQbrcrw+Gw5fu+AfOYvgylJ4TwCoVCs1ardYTruqfj8fgV5OUMSVVT93VdP9dAzpVvm5wJHZFbg2LQ2pEYOlZ/oiDvwNcsFoseY4PBwMCrhaeCJyKWZU37KOJcYdi27QdhcuuBIb073BvTNL8ln4NeeR6NRi/wxZKQcGurQs5oNhqLshzVTMBewW/LMU3TTNlO0ieTiStjYhUIyi6DAp0xbEdgTt+LE0aCKQw24U4llsCs4ZRJrYopB6RwqnpA1YQ5NGFZ1YQ41Z5S8IQQdP5laEBRJcD4Vj5DEsW2gE6s6g3d/YP/g+BDnT7GNi2qCjTwGd6riBzHaaCEd3Js01vwCPIbmWBRx1nwAN/1ov+/drgFWIlfKpVukyYihtgkXNp4mABK+1GtVr+SBhJDbBIubVw+Cd/TDgKO2DPiN3YUo6y/nDCNEIsqTKH1en2tcwA9FKEItyDi3aIh8Gl1sRrVnSDzNFDJT1bAy5xpOYGn5fP5JuL95ZjMIn1ya7j5dPGfv0A5eAnpZUY3n5jXcoec5J67D9q+VuAPM47D3XaSeL4AAAAASUVORK5CYII=&quot;); background-repeat: no-repeat; background-attachment: scroll; background-size: 16px 18px; background-position: 98% 50%; cursor: pointer;">
						</p>
						<p>
							<label class="title">Status:</label>
							<select name="booking_status" id="booking_status" class="pj-form-field required valid" aria-required="true" aria-invalid="false">
								<option value="">-- Choose --</option>
								<option value="confirmed">Confirmed</option><option value="pending">Pending</option><option value="cancelled">Cancelled</option>							</select>
						</p>

					</div>

					<br class="clear_both">
					<div class="t15"></div>
					<div class="p">
						<label class="title">Services:</label>
						<div id="boxBookingItems"></div>
						<input type="hidden" name="booking_items" value="">


					</div>
					<p>
						<label class="title">&nbsp;</label>
						<input type="button" value="+ Add service" class="pj-button item-add" id="myBtn">
						<div id="myModal" class="modal">

							  <!-- Modal content -->
							  <div class="modal-content">
								<div class="modal-header">
								  <span class="close">&times;</span>
								  <h2>Modal Header</h2>
								</div>
								<div class="modal-body">

								  <input type="text" name="servicedate" id="servicedate" class="pj-form-field w500" value="{{ defaultdate }}">
									<select name="services" id="services" >
									</select>

								</div>
								<div class="modal-footer">
								  <h3>Modal Footer</h3>
								</div>
							  </div>

						</div>

							<div id="serviceModal" class="modal">

							  <!-- Modal content -->
							  <div class="modal-content">
								<div class="modal-header">
								  <span class="close">&times;</span>
								  <h2>Modal Header</h2>
								</div>
								<div class="modal-body">

								  <input type="text" name="servicedate_updated" id="servicedate_updated" class="pj-form-field w500" value="{{ defaultdate }}">
									<select name="servicedetails" id="servicedetails" onclick="selectedservice();">
									</select>
									<div class="asContainer" id="employeedetails">

										<div class="asEmployeeName">Amanda Cheng</div>
										<div class="asEmployeeAvatar">   		</div>
										<div class="asEmployeeInfo"> 	<div class="asEmployeeTimeslots"> </div>  </div>
									</div>
								</div>
								<div class="modal-footer">
								  <h3>Modal Footer</h3>
								</div>
							  </div>

						</div>
						<input type="button" value="Recalculate the price" class="pj-button order-calc">
					</p>
					<div class="float_left w350 t15">
						<p>
							<label class="title">Payment method:</label>
							<select name="payment_method" id="payment_method" class="pj-form-field w120 required" aria-required="true">
								<option value="">-- Choose --</option>
								<option value="authorize">Authorize.net</option><option value="bank">Bank account</option><option value="creditcard">Credit card</option>
                                <option value="paypal">Paypal</option>
                            </select>
						</p>
						<p class="erCC" style="display: none">
							<label class="title">CC Type</label>
							<span class="inline_block">
								<select name="cc_type" class="pj-form-field w120">
									<option value="">---</option>
									<option value="maestro">Maestro</option><option value="amex">AmericanExpress</option><option value="mastercard">MasterCard</option><option value="visa">Visa</option>								</select>
							</span>
						</p>
						<p>
							<label class="title">Price:</label>
							<span class="pj-form-field-custom pj-form-field-custom-before">
								<span class="pj-form-field-before"><abbr class="pj-form-field-icon-text">€</abbr></span>
								<input type="text" name="booking_price" id="booking_price" class="pj-form-field number w90 required" readonly="readonly" aria-required="true">
							</span>
						</p>
						<p>
							<label class="title">Deposit:</label>
							<span class="pj-form-field-custom pj-form-field-custom-before">
								<span class="pj-form-field-before"><abbr class="pj-form-field-icon-text">€</abbr></span>
								<input type="text" name="booking_deposit" id="booking_deposit" class="pj-form-field number w90" >
							</span>
						</p>
						<p>
							<label class="title">Tax:</label>
							<span class="pj-form-field-custom pj-form-field-custom-before">
								<span class="pj-form-field-before"><abbr class="pj-form-field-icon-text">€</abbr></span>
								<input type="text" name="booking_tax" id="booking_tax" class="pj-form-field number w90" readonly="readonly">
							</span>
						</p>
						<p>
							<label class="title">Total:</label>
							<span class="pj-form-field-custom pj-form-field-custom-before">
								<span class="pj-form-field-before"><abbr class="pj-form-field-icon-text">€</abbr></span>
								<input type="text" name="booking_total" id="booking_total" class="pj-form-field number w90" readonly="readonly">
							</span>
						</p>

					</div>
					<div class="float_right w350 t15">
						<p>
							<label class="title">Notes:</label>
							<textarea name="c_notes" id="c_notes" class="pj-form-field w334 h120"></textarea>
						</p>
					</div>
				</fieldset>
    <div id="tabs-2" aria-labelledby="ui-id-2" class="ui-tabs-panel ui-widget-content ui-corner-bottom" role="tabpanel" aria-expanded="true" aria-hidden="false" style="display: block;">
						<div class="notice-box">
			<span class="notice-info">&nbsp;</span>
			<span class="block bold">Client details</span><span class="block">Use the form below to enter details about your client.</span><a href="#" class="notice-close"></a>		</div>
						<fieldset class="fieldset white">
					<legend>Customer details</legend>

					<div class="float_left w360">
						<p>
							<label class="title">Country:</label>
							<select name="c_country_id" id="c_country_id" class="pj-form-field w180 custom-chosen">
								<option value="">-- Choose --</option>
								<option value="1">Afghanistan</option><option value="2">Åland Islands</option><option value="3">Albania</option><option value="4">Algeria</option><option value="5">American Samoa</option><option value="6">Andorra</option><option value="7">Angola</option><option value="8">Anguilla</option><option value="9">Antarctica</option><option value="10">Antigua and Barbuda</option><option value="11">Argentina</option><option value="12">Armenia</option><option value="13">Aruba</option><option value="14">Australia</option><option value="15">Austria</option><option value="16">Azerbaijan</option><option value="17">Bahamas</option><option value="18">Bahrain</option><option value="19">Bangladesh</option><option value="20">Barbados</option><option value="21">Belarus</option><option value="22">Belgium</option><option value="23">Belize</option><option value="24">Benin</option><option value="25">Bermuda</option><option value="26">Bhutan</option><option value="27">Bolivia, Plurinational State of</option><option value="28">Bonaire, Sint Eustatius and Saba</option><option value="29">Bosnia and Herzegovina</option><option value="30">Botswana</option><option value="31">Bouvet Island</option><option value="32">Brazil</option><option value="33">British Indian Ocean Territory</option><option value="34">Brunei Darussalam</option><option value="35">Bulgaria</option><option value="36">Burkina Faso</option><option value="37">Burundi</option><option value="38">Cambodia</option><option value="39">Cameroon</option><option value="40">Canada</option><option value="41">Cape Verde</option><option value="42">Cayman Islands</option><option value="43">Central African Republic</option><option value="44">Chad</option><option value="45">Chile</option><option value="46">China</option><option value="47">Christmas Island</option><option value="48">Cocos array(Keeling) Islands</option><option value="49">Colombia</option><option value="50">Comoros</option><option value="51">Congo</option><option value="52">Congo, the Democratic Republic of the</option><option value="53">Cook Islands</option><option value="54">Costa Rica</option><option value="55">Côte d'Ivoire</option><option value="56">Croatia</option><option value="57">Cuba</option><option value="58">Curaçao</option><option value="59">Cyprus</option><option value="60">Czech Republic</option><option value="61">Denmark</option><option value="62">Djibouti</option><option value="63">Dominica</option><option value="64">Dominican Republic</option><option value="65">Ecuador</option><option value="66">Egypt</option><option value="67">El Salvador</option><option value="68">Equatorial Guinea</option><option value="69">Eritrea</option><option value="70">Estonia</option><option value="71">Ethiopia</option><option value="72">Falkland Islands array(Malvinas)</option><option value="73">Faroe Islands</option><option value="74">Fiji</option><option value="75">Finland</option><option value="76">France</option><option value="77">French Guiana</option><option value="78">French Polynesia</option><option value="79">French Southern Territories</option><option value="80">Gabon</option><option value="81">Gambia</option><option value="82">Georgia</option><option value="83">Germany</option><option value="84">Ghana</option><option value="85">Gibraltar</option><option value="86">Greece</option><option value="87">Greenland</option><option value="88">Grenada</option><option value="89">Guadeloupe</option><option value="90">Guam</option><option value="91">Guatemala</option><option value="92">Guernsey</option><option value="93">Guinea</option><option value="94">Guinea-Bissau</option><option value="95">Guyana</option><option value="96">Haiti</option><option value="97">Heard Island and McDonald Islands</option><option value="98">Holy See array(Vatican City State)</option><option value="99">Honduras</option><option value="100">Hong Kong</option><option value="101">Hungary</option><option value="102">Iceland</option><option value="103">India</option><option value="104">Indonesia</option><option value="105">Iran, Islamic Republic of</option><option value="106">Iraq</option><option value="107">Ireland</option><option value="108">Isle of Man</option><option value="109">Israel</option><option value="110">Italy</option><option value="111">Jamaica</option><option value="112">Japan</option><option value="113">Jersey</option><option value="114">Jordan</option><option value="115">Kazakhstan</option><option value="116">Kenya</option><option value="117">Kiribati</option><option value="118">Korea, Democratic People's Republic of</option><option value="119">Korea, Republic of</option><option value="120">Kuwait</option><option value="121">Kyrgyzstan</option><option value="122">Lao People's Democratic Republic</option><option value="123">Latvia</option><option value="124">Lebanon</option><option value="125">Lesotho</option><option value="126">Liberia</option><option value="127">Libya</option><option value="128">Liechtenstein</option><option value="129">Lithuania</option><option value="130">Luxembourg</option><option value="131">Macao</option><option value="132">Macedonia, The Former Yugoslav Republic of</option><option value="133">Madagascar</option><option value="134">Malawi</option><option value="135">Malaysia</option><option value="136">Maldives</option><option value="137">Mali</option><option value="138">Malta</option><option value="139">Marshall Islands</option><option value="140">Martinique</option><option value="141">Mauritania</option><option value="142">Mauritius</option><option value="143">Mayotte</option><option value="144">Mexico</option><option value="145">Micronesia, Federated States of</option><option value="146">Moldova, Republic of</option><option value="147">Monaco</option><option value="148">Mongolia</option><option value="149">Montenegro</option><option value="150">Montserrat</option><option value="151">Morocco</option><option value="152">Mozambique</option><option value="153">Myanmar</option><option value="154">Namibia</option><option value="155">Nauru</option><option value="156">Nepal</option><option value="157">Netherlands</option><option value="158">New Caledonia</option><option value="159">New Zealand</option><option value="160">Nicaragua</option><option value="161">Niger</option><option value="162">Nigeria</option><option value="163">Niue</option><option value="164">Norfolk Island</option><option value="165">Northern Mariana Islands</option><option value="166">Norway</option><option value="167">Oman</option><option value="168">Pakistan</option><option value="169">Palau</option><option value="170">Palestine, State of</option><option value="171">Panama</option><option value="172">Papua New Guinea</option><option value="173">Paraguay</option><option value="174">Peru</option><option value="175">Philippines</option><option value="176">Pitcairn</option><option value="177">Poland</option><option value="178">Portugal</option><option value="179">Puerto Rico</option><option value="180">Qatar</option><option value="181">Réunion</option><option value="182">Romania</option><option value="183">Russian Federation</option><option value="184">Rwanda</option><option value="185">Saint Barthélemy</option><option value="186">Saint Helena, Ascension and Tristan da Cunha</option><option value="187">Saint Kitts and Nevis</option><option value="188">Saint Lucia</option><option value="189">Saint Martin array(French part)</option><option value="190">Saint Pierre and Miquelon</option><option value="191">Saint Vincent and the Grenadines</option><option value="192">Samoa</option><option value="193">San Marino</option><option value="194">Sao Tome and Principe</option><option value="195">Saudi Arabia</option><option value="196">Senegal</option><option value="197">Serbia</option><option value="198">Seychelles</option><option value="199">Sierra Leone</option><option value="200">Singapore</option><option value="201">Sint Maarten array(Dutch part)</option><option value="202">Slovakia</option><option value="203">Slovenia</option><option value="204">Solomon Islands</option><option value="205">Somalia</option><option value="206">South Africa</option><option value="207">South Georgia and the South Sandwich Islands</option><option value="208">South Sudan</option><option value="209">Spain</option><option value="210">Sri Lanka</option><option value="211">Sudan</option><option value="212">Suriname</option><option value="213">Svalbard and Jan Mayen</option><option value="214">Swaziland</option><option value="215">Sweden</option><option value="216">Switzerland</option><option value="217">Syrian Arab Republic</option><option value="218">Taiwan, Province of China</option><option value="219">Tajikistan</option><option value="220">Tanzania, United Republic of</option><option value="221">Thailand</option><option value="222">Timor-Leste</option><option value="223">Togo</option><option value="224">Tokelau</option><option value="225">Tonga</option><option value="226">Trinidad and Tobago</option><option value="227">Tunisia</option><option value="228">Turkey</option><option value="229">Turkmenistan</option><option value="230">Turks and Caicos Islands</option><option value="231">Tuvalu</option><option value="232">Uganda</option><option value="233">Ukraine</option><option value="234">United Arab Emirates</option><option value="235">United Kingdom</option><option value="236">United States</option><option value="237">United States Minor Outlying Islands</option><option value="238">Uruguay</option><option value="239">Uzbekistan</option><option value="240">Vanuatu</option><option value="241">Venezuela, Bolivarian Republic of</option><option value="242">Viet Nam</option><option value="243">Virgin Islands, British</option><option value="244">Virgin Islands, U.S.</option><option value="245">Wallis and Futuna</option><option value="246">Western Sahara</option><option value="247">Yemen</option><option value="248">Zambia</option><option value="249">Zimbabwe</option>							</select>
						</p>
						<p>
							<label class="title">State:</label>
							<input type="text" name="c_state" id="c_state" class="pj-form-field w180">
						</p>
					</div>
					<div class="float_right w350">
						<p>
							<label class="title">City:</label>
							<input type="text" name="c_city" id="c_city" class="pj-form-field w160">
						</p>
						<p>
							<label class="title">Zip:</label>
							<input type="text" name="c_zip" id="c_zip" class="pj-form-field w80">
						</p>
					</div>
					<br class="clear_both">
					<p>
						<label class="title">Name:</label>
						<input type="text" name="c_name" id="c_name" class="pj-form-field w300 required" aria-required="true">
					</p>
					<p>
						<label class="title">Email:</label>
						<span class="pj-form-field-custom pj-form-field-custom-before">
							<span class="pj-form-field-before"><abbr class="pj-form-field-icon-email"></abbr></span>
							<input type="text" name="c_email" id="c_email" class="pj-form-field email w250">
						</span>
					</p>
					<p>
						<label class="title">Phone:</label>
						<span class="pj-form-field-custom pj-form-field-custom-before">
							<span class="pj-form-field-before"><abbr class="pj-form-field-icon-phone"></abbr></span>
							<input type="text" name="c_phone" id="c_phone" class="pj-form-field w250">
						</span>
					</p>
					<p>
						<label class="title">Address Line 1:</label>
						<input type="text" name="c_address_1" id="c_address_1" class="pj-form-field w500">
					</p>
					<p>
						<label class="title">Address Line 2:</label>
						<input type="text" name="c_address_2" id="c_address_2" class="pj-form-field w500">
					</p>
					<p>
						<label class="title">&nbsp;</label>
						<input type="submit" value="Save" class="pj-button">
						<input type="button" value="Cancel" class="pj-button" onclick="window.location.href='http://demo.phpjabbers.com/1502894119_196/index.php?controller=pjAdminBookings&amp;action=pjActionIndex';">
					</p>
				</fieldset>

			</div>
     </form>
    </div>


<!-- Trigger/Open The Modal -->
<!-- The Modal -->

<script>
// Get the modal
var modal = document.getElementById('myModal');

// Get the button that opens the modal
var btn = document.getElementById("myBtn");

// Get the <span> element that closes the modal
var span = document.getElementsByClassName("close")[0];

// When the user clicks the button, open the modal
btn.onclick = function() {
    modal.style.display = "block";
}

// When the user clicks on <span> (x), close the modal
span.onclick = function() {
    modal.style.display = "none";
}

// When the user clicks anywhere outside of the modal, close it
window.onclick = function(event) {
    if (event.target == modal) {
        modal.style.display = "none";
    }
}

// When the user clicks the button, open the modal
services.onchange = function() {
    serviceModal.style.display = "block";

}
<!--$('#serviceModal').on('load', function() {-->
	<!--alert("hello")-->
	<!--selectedservice();-->
<!--})-->


$(document).ready(function() {
  // Handler for .ready() called.
  listServices() ;
});

function listServices() {

    $.ajax({
            method:'get',
            url:"{% url 'appointmentschduler:listServicesName'  %}",

            success:function(response){
                // console.log(response);
                servicelist =eval(response);
                var serviceName ="";
                var $select = $('#services');

                $select.append('<option value="" disabled selected>Please select a service...</option>')

                if (servicelist != null &&  servicelist.length > 0  ){
                      for (var i = 0; i <  servicelist.length; i++)
                      {
                           $select.append('<option value="' + servicelist[i].id + '">' + servicelist[i].name +'</option>');
                      }

                }

            }
      });
  }


  function selectedservice() {
    $.ajax({
            method:'get',
            url:"{% url 'appointmentschduler:listServicesName'  %}",
            async: false,

            success:function(response){
                // console.log(response);
                servicelist =eval(response);
                var serviceName ="";
                var $select = $('#servicedetails');
				serviceid =  $('#services :selected').val();
                if (servicelist != null &&  servicelist.length > 0  ){
                $select.append('<option value="" disabled selected>Please select a service...</option>')

				   $.each(servicelist, function(key, val){
							if (val.id == serviceid) {

							$select.append('<option selected value="' + val.id + '">' + val.name + '</option>');
							}
							else {
								$select.append('<option value="' + val.id + '">' + val.name + '</option>');

							}
				   });
                }

            }
      });

		serviceid =  $('#servicedetails :selected').val();
		servicedate =  $('#servicedate_updated').val();
		alert(serviceid);
       $.ajax({
            method:'get',
            url:"{% url 'appointmentschduler:employeeinbooking'  %}",
			data: {
				"serviceid" : serviceid,
				"servicedate" : servicedate
			},
			dataType: "json", //set to JSON    

            success:function(data){
                // console.log(response);

	             var employeedetails = data;
	            
	            var output="";
	            for (var i in employeedetails) 
	            {
	                output+="<div><span>" + employeedetails[i].name  + "</span>";
	                output +='<span> <img src=' + employeedetails[i].image + ' alt="Smiley face" height="42" width="42"></span>';
	                 for (var j in employeedetails[i].workinghours) 
		            {
		                output+="<span>" + employeedetails[i].workinghours[j].interval  + "</span>";
		                
		                

		            }
		            output+="</div>";

	            }
	            
	            $('#employeedetails').html(output);

            }
      });
  }
</script>


{% endblock %}