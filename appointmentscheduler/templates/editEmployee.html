{% extends "base.html" %}
{% load static from staticfiles %}
{% load admin_urls %}
{% load bootstrap3 %}
{% block title %}Dashboard{% endblock %}
{% block extraHeader %}
{% endblock %}
{% block content %}


<script>

$(document).ready(function() {
  // Handler for .ready() called.
  listServices("{{ appscheduleinst.id }}") ;
  
});



function getCookie(name) {
    var cookieValue = null;
    if (document.cookie && document.cookie != '') {
        var cookies = document.cookie.split(';');
        for (var i = 0; i < cookies.length; i++) {
            var cookie = jQuery.trim(cookies[i]);
            // Does this cookie string begin with the name we want?
            if (cookie.substring(0, name.length + 1) == (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

$.ajaxSetup({
    beforeSend: function(xhr, settings) {
        if (!(/^http:.*/.test(settings.url) || /^https:.*/.test(settings.url))) {
            // Only send the token to relative URLs i.e. locally.
            xhr.setRequestHeader("X-CSRFToken", getCookie('csrftoken'));
        }
    },

    error: function(xhr, textStatus, error) {
        console.log(error);
    }
});


var expanded = false;
function showCheckboxes() {
  var checkboxes = document.getElementById("checkboxes");
  if (!expanded) {
    checkboxes.style.display = "block";
    expanded = true;
  } else {
    checkboxes.style.display = "none";
    expanded = false;
  }
}


function listServices(employeeid) {

    $.ajax({
            method:'get',
            url:"/appointmentschduler/associated_service_names/" + employeeid,
            data: { },
            dataType: "json",
           
            success:function(response){
                // console.log(response);
                servicelist =eval(response);
                var serviceName ="";

                if (servicelist != null &&  servicelist.length > 0  ){
                      for (var i = 0; i <  servicelist.length; i++)
                      {
      	                  checked="";
			              if (servicelist[i].checked) {
			                     checked = "checked" ;
			               }
                          serviceName+= "<label for=" + servicelist[i].name +  ' > <input type="checkbox" name=' + "check" +  servicelist[i].id.toString() +       " value=" + servicelist[i].id + " " + checked + " />" + servicelist[i].name + " </label>";
                      }
                      $( "#checkboxes" ).append( serviceName);

                }

            }
      });
  }
 

 var invalid_phone = true;	

 function check_duplicated_phoneno(current_phone) {

    $.ajax({
            method:'get',
            url:"{% url 'appointmentschduler:listphones'  %}",
          
            success:function(response){
                // console.log(response);
                listphones =eval(response);
                var x = document.getElementById("id_phone");
                textvalue = x.value.trim();
                if (listphones != null &&  listphones.length > 0  ){
                      for (var i = 0; i <  listphones.length; i++)
                      {
                          phoneno= listphones[i].phone.trim(); 
                          if (phoneno == textvalue  && current_phone != textvalue ) {
                             alert("phone numer already exist");
                             invalid_phone = false;
                             return false;
                          }
                          invalid_phone = true;

                      }

                }

            }
      });
  }  

  var invalid_email = true;
  function check_duplicated_email(current_email) {

    $.ajax({
            method:'get',
            url:"{% url 'appointmentschduler:listemails'  %}",
          
            success:function(response){
                // console.log(response);
                listemails =eval(response);
                var servicename ="";
                var x = document.getElementById("id_email");
                textvalue = x.value.trim();
                if (listemails != null &&  listemails.length > 0  ){
                      for (var i = 0; i <  listemails.length; i++)
                      {
                          email= listemails[i].email.trim(); 
                          if (email == textvalue && current_email != textvalue) {
                             alert("Email already exist");
                             invalid_email = false;
                             return false;
                          }	     
                          invalid_email = true;

                      }

                }

            }
      });
  }  
    
 function setsubscribe() {

	    var is_subscribed = document.getElementById("is_subscribed");
	     is_subscribed.value = is_subscribed.checked ? 1: 0 ;

	    var is_subscribed_sms = document.getElementById("is_subscribed_sms");
	     is_subscribed_sms.value = is_subscribed_sms.checked ? 1: 0 ;

	     if( ! invalid_email ) {
	     	alert("Email already exist");
	     	return false;	
	     }
	     if( ! invalid_phone ) {
	     	alert("Phone no already exist");
	     	return false;	
	     }
	     return true;
}   

function delete_image(employeeid) {
    $.ajax({
            method:'get',
            url:"/appointmentschduler/deleteemployeeimage/" + employeeid ,
            data: { },
            success:function(response){
                console.log(response);
                $("#employee_img_id").attr("src",response);
                $("#deleteimage").hide();

            },
             error: function(xhr, status, error){
             var err = eval("(" + xhr.responseText + ")");
             }
    });  

}
 
</script>

<div id="container">
	
	<div id="header">
        <div id="logo">
        	    <a href="javascript:void();" target="_blank" rel="nofollow">
                365 Plateform</a> <span>v1.0</span>
        </div>
    </div>

<div id="middle">
  <div id="right">
			
<div>"{{ form.errors|default:"" }}"</div>

<form ng-app="ServiceMod" ng-controller="EmployeeCtrl"  action="{% url 'appointmentschduler:editEmployee' appscheduleinst.id %}" method="post" id="frmCreateEmployee" class="form pj-form" enctype="multipart/form-data" autocomplete="off" novalidate="novalidate"   onsubmit="return setsubscribe()" >
		<input name="employee_create" value="1" type="hidden">
		<input style="display:none">
		<input style="display:none" type="password">
					<p class="pj-multilang-wrap" data-index="1" style="display: ">
				<label class="title">Employee name:</label>
				<span class="inline_block">

				  <input id="id_emp_name" maxlength="100" name="emp_name"  type="text"  value="{{ appscheduleinst.emp_name }}" required="" />

            </span>
			</p>
					<p>
			<label class="title">Notes:</label>
			  <input id="id_emp_notes" maxlength="100" name="emp_notes"  type="text" value="{{ appscheduleinst.emp_notes }}" />
				
		</p>
		<p style="position: relative">
			<label class="title">Email</label>
			<span class="pj-form-field-custom pj-form-field-custom-before">
				<span class="pj-form-field-before"><abbr class="pj-form-field-icon-email"></abbr></span>
				 <input id="id_email" maxlength="600" name="email"  type="text" value="{{ appscheduleinst.email }}"  onblur='check_duplicated_email("{{ appscheduleinst.email }}")''  required="" />
			</span>
			<span style="position: absolute; top: 7px; left: 405px">
				<label>
				<input id="is_subscribed" maxlength="600" name="is_subscribed"  type="checkbox" value="{{ appscheduleinst.is_subscribed }}"  {% if appscheduleinst.is_subscribed == 1 %} checked {% endif %} required="" />

				Send email when new booking is made</label>
			</span>
		</p>
		<p>
			<label class="title">Password</label>
			<span class="pj-form-field-custom pj-form-field-custom-before">
				<span class="pj-form-field-before"><abbr class="pj-form-field-icon-password"></abbr></span>
				<input id="id_password" maxlength="10" name="password"  type="password" value="{{ appscheduleinst.password }}" required="" />
			</span>
		</p>
		<p style="position: relative">
			<label class="title">Phone</label>
				<span class="pj-form-field-custom pj-form-field-custom-before">
				<span class="pj-form-field-before"><abbr class="pj-form-field-icon-phone"></abbr></span>
				<input id="id_phone" maxlength="600" name="phone"  type="text" value="{{ appscheduleinst.phone }}" onblur='check_duplicated_phoneno("{{ appscheduleinst.phone }}")'  required="" />
			</span>
			<span style="position: absolute; top: 7px; left: 405px">
				<label>
					<input id="is_subscribed_sms" maxlength="600" name="is_subscribed_sms"  type="checkbox" value="{{ appscheduleinst.is_subscribed_sms }}"   {% if appscheduleinst.is_subscribed_sms == 1 %} checked {% endif %}  />
				Send SMS when new booking is made</label>
			</span>
		</p>
		<p>
			<label class="title">Services</label>
			  <div class="multiselect">
        <div class="selectBox" onclick="showCheckboxes()" >
            <select>
              <option>Select an option</option>
            </select>
            <div class="overSelect">
              
            </div>
        </div>
        <div id="checkboxes"  >
        </div>
    </div>
		</p>
		<p>
			<label class="title">Status</label>
			<span class="inline_block">
				<select name="is_active" id="is_active" class="pj-form-field required valid" value="{{ appscheduleinst.is_active }}"  aria-required="true" aria-invalid="false">
					<option {% if appscheduleinst.is_active == 1 %} selected {% endif %} value="1">Active</option>
					<option {% if appscheduleinst.is_active == 0 	%} selected {% endif %} value="0">Inactive</option>
				</select>
			</span>
		</p>
		<p>
            <label class="title">
                Image</label></br>
           <span class="fieldWrapper">
                 <img id="employee_img_id" src='{{ appscheduleinst.avatar.url }}'  width=25% height= 25% />
                  <p><label for="id_photo">Employee image</label>
                </a> <br> <input type="file" name="avatar" id="id_avatar"></p>
                {% if appscheduleinst.avatar.name != defaultimg %}
                        <input type="button"  value="Delete image" id="deleteimage" onclick='delete_image( "{{  appscheduleinst.id }}" )' >

                {% endif %}

            </span>

        </p>
		<p>
			<label class="title">&nbsp;</label>
			<input value="submit" class="pj-button" type="submit" >
		</p>
	</form>
 

  </div>
</div>


</div>




{% endblock %}


